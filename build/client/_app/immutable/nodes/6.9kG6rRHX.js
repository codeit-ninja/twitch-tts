var V=Object.defineProperty;var X=(i,r,e)=>r in i?V(i,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[r]=e;var R=(i,r,e)=>(X(i,typeof r!="symbol"?r+"":r,e),e),Y=(i,r,e)=>{if(!r.has(i))throw TypeError("Cannot "+e)};var w=(i,r,e)=>(Y(i,r,"read from private field"),e?e.call(i):r.get(i)),P=(i,r,e)=>{if(r.has(i))throw TypeError("Cannot add the same private member more than once");r instanceof WeakSet?r.add(i):r.set(i,e)};import"../chunks/disclose-version.bJ1TNjgf.js";import{r as G,p as j,a as M,v as H,w as W,x as U,b as Z,a2 as b,i as $}from"../chunks/runtime.CFl1NsvJ.js";import{z,D as ee,h as x,B as J,a as E,x as te,t as se,E as ne,j as L,s as O,d as S,p as T,F,c as D,o as re,b as I,C as ie,f as B}from"../chunks/render.ghOspvTV.js";import{e as q}from"../chunks/each.XM42tCkC.js";import{b as ae}from"../chunks/store.Z4QFliSE.js";import{o as oe}from"../chunks/main-client.X9p070dd.js";var ce=S('<span class="material-symbols-rounded"> </span>'),ue=S('<div class="widget"><div class="widget--header"><h3 class="widget--title"><!> </h3></div> <div class="widget--content"><!></div></div>');function le(i,r){M(r,!0);var e=L(i,!0,ue),o=E(e),h=E(o),p=E(h),_=O(p,!0),u=O(O(o,!0)),c=E(u);G(()=>{te(h,"widget--title--icon",!!r.icon),se(_,` ${ne(r.title)}`)}),z(p,()=>r.icon,n=>{var t=L(n,!0,ce),s=E(t);J(s,()=>r.icon),x(n,t)},null),ee(()=>r.children,c),x(i,e),j()}const fe="67kqvxzgx6pvdyjlrkbmdty1kns90v";function ve(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var K={exports:{}};(function(i){var r=Object.prototype.hasOwnProperty,e="~";function o(){}Object.create&&(o.prototype=Object.create(null),new o().__proto__||(e=!1));function h(c,n,t){this.fn=c,this.context=n,this.once=t||!1}function p(c,n,t,s,f){if(typeof t!="function")throw new TypeError("The listener must be a function");var l=new h(t,s||c,f),v=e?e+n:n;return c._events[v]?c._events[v].fn?c._events[v]=[c._events[v],l]:c._events[v].push(l):(c._events[v]=l,c._eventsCount++),c}function _(c,n){--c._eventsCount===0?c._events=new o:delete c._events[n]}function u(){this._events=new o,this._eventsCount=0}u.prototype.eventNames=function(){var n=[],t,s;if(this._eventsCount===0)return n;for(s in t=this._events)r.call(t,s)&&n.push(e?s.slice(1):s);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},u.prototype.listeners=function(n){var t=e?e+n:n,s=this._events[t];if(!s)return[];if(s.fn)return[s.fn];for(var f=0,l=s.length,v=new Array(l);f<l;f++)v[f]=s[f].fn;return v},u.prototype.listenerCount=function(n){var t=e?e+n:n,s=this._events[t];return s?s.fn?1:s.length:0},u.prototype.emit=function(n,t,s,f,l,v){var m=e?e+n:n;if(!this._events[m])return!1;var a=this._events[m],g=arguments.length,y,d;if(a.fn){switch(a.once&&this.removeListener(n,a.fn,void 0,!0),g){case 1:return a.fn.call(a.context),!0;case 2:return a.fn.call(a.context,t),!0;case 3:return a.fn.call(a.context,t,s),!0;case 4:return a.fn.call(a.context,t,s,f),!0;case 5:return a.fn.call(a.context,t,s,f,l),!0;case 6:return a.fn.call(a.context,t,s,f,l,v),!0}for(d=1,y=new Array(g-1);d<g;d++)y[d-1]=arguments[d];a.fn.apply(a.context,y)}else{var Q=a.length,C;for(d=0;d<Q;d++)switch(a[d].once&&this.removeListener(n,a[d].fn,void 0,!0),g){case 1:a[d].fn.call(a[d].context);break;case 2:a[d].fn.call(a[d].context,t);break;case 3:a[d].fn.call(a[d].context,t,s);break;case 4:a[d].fn.call(a[d].context,t,s,f);break;default:if(!y)for(C=1,y=new Array(g-1);C<g;C++)y[C-1]=arguments[C];a[d].fn.apply(a[d].context,y)}}return!0},u.prototype.on=function(n,t,s){return p(this,n,t,s,!1)},u.prototype.once=function(n,t,s){return p(this,n,t,s,!0)},u.prototype.removeListener=function(n,t,s,f){var l=e?e+n:n;if(!this._events[l])return this;if(!t)return _(this,l),this;var v=this._events[l];if(v.fn)v.fn===t&&(!f||v.once)&&(!s||v.context===s)&&_(this,l);else{for(var m=0,a=[],g=v.length;m<g;m++)(v[m].fn!==t||f&&!v[m].once||s&&v[m].context!==s)&&a.push(v[m]);a.length?this._events[l]=a.length===1?a[0]:a:_(this,l)}return this},u.prototype.removeAllListeners=function(n){var t;return n?(t=e?e+n:n,this._events[t]&&_(this,t)):(this._events=new o,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=e,u.EventEmitter=u,i.exports=u})(K);var de=K.exports;const he=ve(de);var N,A,k;class pe extends he{constructor(){super();P(this,N,H());P(this,A,H("wss://eventsub.wss.twitch.tv/ws"));R(this,"wss");P(this,k,H("CLOSED"));Z(()=>{this.session&&(this.on("SESSION",this.createSubscriptions),this.emit("SESSION",this.session))})}get session(){return W(w(this,N))}set session(e){U(w(this,N),T(e))}get url(){return W(w(this,A))}set url(e){U(w(this,A),T(e))}get state(){return W(w(this,k))}set state(e){U(w(this,k),T(e))}async connect(){return new Promise((e,o)=>{this.wss=new WebSocket(this.url),this.wss.addEventListener("open",h=>{this.state="OPEN",this.createEvents(),e(h)}),this.wss.addEventListener("error",h=>{this.state="CLOSED",o(h)})})}createEvents(){this.wss&&this.wss.addEventListener("message",e=>{const o=JSON.parse(e.data);this.isEvent(o,"notification")&&this.fireEvent(o.metadata.subscription_type,o.payload.event),this.isEvent(o,"session_welcome")&&(this.session=o.payload.session)})}fireEvent(e,o){({"channel.chat.message":()=>this.emit("CHANNEL:CHAT:MESSAGE",o),"channel.channel_points_custom_reward_redemption.add":()=>this.emit("CHANNEL:CHANNEL_POINTS_CUSTOM_REWARD_REDEMPTION:ADD",o)})[e]()}isEvent(e,o){return e.metadata.message_type===o}isSubscription(e,o){return e.metadata.subscription_type===o}async createSubscriptions(){this.subscribe("channel.chat.message"),this.subscribe("channel.channel_points_custom_reward_redemption.add")}async subscribe(e){if(!this.session)return;const{twitchUserId:o,accessToken:h}=ae.get(),p={type:e,version:"1",condition:{broadcaster_user_id:"37516578",user_id:o},transport:{method:"websocket",session_id:this.session.id}};return await fetch("https://api.twitch.tv/helix/eventsub/subscriptions",{method:"POST",body:JSON.stringify(p),headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`,"Client-Id":fe}})}}N=new WeakMap,A=new WeakMap,k=new WeakMap;var _e=S("<img>"),me=S("<!> <!>",!0),ge=S('<div class="element--chat--message svelte-1os8a3d svelte-1os8a3d"><span class="svelte-1os8a3d"></span></div>');function ye(i,r){M(r,!0),console.log(r.data.badges);var e=L(i,!0,ge),o=E(e);q(o,()=>r.data.message.fragments,73,(h,p,_)=>{var u=re(h,!0,me),c=I(u),n=O(O(c,!0));z(c,()=>b(p).type==="emote",t=>{var s=L(t,!0,_e),f,l;G(()=>{f!==(f=`https://static-cdn.jtvnw.net/emoticons/v2/${b(p).emote.id}/default/dark/1.0`)&&F(s,"src",f),l!==(l=b(p).text)&&F(s,"alt",l)}),x(t,s)},null),z(n,()=>b(p).type==="text",t=>{var s=ie(t);J(s,()=>b(p).text),x(t,s)},null),D(h,u)},null),x(i,e),j()}var we=S('<div class="widget--stream--chat svelte-dfwx7y"></div>');function be(i,r){M(r,!0);const e=T([]),o=new pe;oe(()=>{o.connect()}),o.on("CHANNEL:CHAT:MESSAGE",_=>{e.push(_),console.log(e)});var h=B(i),p=I(h);le(p,{get title(){return r.title},get icon(){return r.icon},children:(_,u)=>{var c=L(_,!0,we);q(c,()=>e,73,(n,t,s)=>{var f=B(n),l=I(f);ye(l,{get data(){return b(t)}}),D(n,f)},null),x(_,c)}}),D(i,h),j()}function Ae(i,r){M(r,!1),$();var e=B(i),o=I(e);be(o,{title:"Stream chat",icon:"notes"}),D(i,e),j()}export{Ae as component};
